<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tesco.pma.dao.SubsidiaryPermissionDAO">
    <resultMap id="SubsidiaryPermission" type="com.tesco.pma.api.security.SubsidiaryPermission">
        <id property="subsidiaryUuid" column="subsidiary_uuid"/>
        <id property="colleagueUuid" column="colleague_uuid"/>
        <id property="role" column="role"/>
    </resultMap>

    <insert id="create">
        INSERT INTO subsidiary_permission (colleague_uuid, subsidiary_uuid, role)
        VALUES (#{permission.colleagueUuid},
                #{permission.subsidiaryUuid},
                #{permission.role})
    </insert>

    <update id="delete">
        DELETE
        FROM subsidiary_permission
        WHERE colleague_uuid = #{permission.colleagueUuid}
          AND subsidiary_uuid = #{permission.subsidiaryUuid}
          AND role = #{permission.role}
    </update>

    <select id="findBySubsidiaryUuid" resultMap="SubsidiaryPermission">
        SELECT colleague_uuid, subsidiary_uuid, role
        FROM subsidiary_permission
        WHERE subsidiary_uuid = #{subsidiaryUuid}
    </select>

    <select id="findByColleagueUuid" resultMap="SubsidiaryPermission">
        SELECT colleague_uuid, subsidiary_uuid, role
        FROM subsidiary_permission
        WHERE colleague_uuid = #{colleagueUuid}
    </select>

    <select id="findByColleagueUuids" resultMap="SubsidiaryPermission">
        SELECT colleague_uuid, subsidiary_uuid, role
        FROM subsidiary_permission
        <where>
            <choose>
                <when test="colleagueUuids != null and !colleagueUuids.isEmpty()">
                    colleague_uuid IN
                    <foreach collection="colleagueUuids" open="(" separator="," close=")" item="colleagueUuid">
                        #{colleagueUuid}
                    </foreach>
                </when>
                <otherwise>
                    1=0
                </otherwise>
            </choose>
        </where>
    </select>

</mapper>