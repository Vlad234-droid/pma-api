<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tesco.pma.colleague.profile.dao.ColleagueDAO">

    <update id="update" flushCache="true">
        UPDATE colleague
        SET first_name       = #{colleague.firstName},
            middle_name      = #{colleague.middleName},
            last_name        = #{colleague.lastName},
            email            = #{colleague.email},
            primary_entity   = #{colleague.primaryEntity},
            salary_frequency = #{colleague.salaryFrequency},
            iam_source       = #{colleague.iamSource},
            iam_id           = #{colleague.iamId},
            manager_uuid     = #{colleague.managerUuid},
            employment_type  = #{colleague.employmentType},
            hire_date        = #{colleague.hireDate},
            leaving_date     = #{colleague.leavingDate},
            is_manager       = #{colleague.manager},
            country_code     = #{colleague.country.code},
            work_level       = #{colleague.workLevel.code},
            department_id    = #{colleague.department.id},
            job_id           = #{colleague.job.id}
        WHERE uuid = #{colleague.uuid}
    </update>

    <insert id="insertJob" flushCache="true">
        INSERT INTO job (id, code, name, cost_category)
        VALUES (#{job.id},
                #{job.code},
                #{job.name},
                #{job.costCategory})
                ON CONFLICT (id) DO UPDATE SET
                    (code, name, cost_category) = (EXCLUDED.code, EXCLUDED.name, EXCLUDED.cost_category)
    </insert>

    <insert id="insertCountry" flushCache="true">
        INSERT INTO country (code, name)
        VALUES (#{country.code},
                #{country.name})
                ON CONFLICT (code) DO UPDATE SET
                    name = EXCLUDED.name
    </insert>

    <insert id="insertWorkLevel" flushCache="true">
        INSERT INTO work_level (code, name)
        VALUES (#{workLevel.code},
                #{workLevel.name})
                ON CONFLICT (code) DO UPDATE SET
                    name = EXCLUDED.name
    </insert>

    <insert id="insertDepartment" flushCache="true">
        INSERT INTO department (id, name, business_type)
        VALUES (#{department.id},
                #{department.name},
                #{department.businessType})
                ON CONFLICT (id) DO UPDATE SET
                    (name, business_type) = (EXCLUDED.name, EXCLUDED.business_type)
    </insert>

</mapper>